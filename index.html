<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Candidature en Ligne - Monde et Bonheur ONG</title>
    <style>
        :root { --primary-color: #005A9C; --light-gray: #f4f7f6; --dark-gray: #333; --border-color: #ccc; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: var(--light-gray); margin: 0; padding: 2rem; color: var(--dark-gray); display: flex; align-items: center; justify-content: center; min-height: 100vh; }
        .form-container { max-width: 800px; width: 100%; background-color: #ffffff; padding: 2.5rem 3rem 4rem 3rem; border-radius: 10px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1); overflow: hidden; }
        .header { display: flex; align-items: center; justify-content: center; margin-bottom: 1rem; flex-wrap: wrap; }
        .logo { height: 50px; margin-right: 15px; }
        .header h2 { color: var(--dark-gray); font-size: 1.2rem; text-align: center; margin: 0; }
        h1 { color: var(--primary-color); text-align: center; margin-bottom: 2rem; font-size: 1.8rem; }
        .progress-bar { display: flex; justify-content: space-between; margin-bottom: 3rem; counter-reset: step; }
        .progress-step { width: 100%; text-align: center; position: relative; }
        .progress-step::before { counter-increment: step; content: counter(step); width: 30px; height: 30px; line-height: 30px; border: 2px solid var(--border-color); border-radius: 50%; display: block; margin: 0 auto 10px auto; background-color: white; color: var(--dark-gray); transition: all 0.3s ease; }
        .progress-step::after { content: ''; position: absolute; width: calc(100% - 40px); height: 2px; background-color: var(--border-color); top: 15px; left: -50%; z-index: -1; transition: all 0.3s ease; }
        .progress-step:first-child::after { content: none; }
        .progress-step.active::before { background-color: var(--primary-color); border-color: var(--primary-color); color: white; }
        .progress-step.active::after { background-color: var(--primary-color); }
        .form-step { display: none; animation: fadeIn 0.5s; }
        .form-step.active { display: block; }
        legend { font-size: 1.5rem; font-weight: 600; color: var(--primary-color); margin-bottom: 0.5rem; border: none; }
        .reassurance-message { font-size: 0.95rem; color: #7f8c8d; margin-bottom: 2rem; font-style: italic; }
        .form-group { margin-bottom: 1.5rem; }
        label { display: block; margin-bottom: 0.5rem; font-weight: 500; }
        input, select, textarea { width: 100%; padding: 0.8rem; border: 1px solid var(--border-color); border-radius: 5px; box-sizing: border-box; font-size: 1rem; }
        input.invalid, select.invalid, textarea.invalid { border-color: #e74c3c; }
        .btn-whatsapp { float: right; background-color: #25D366; color: white; padding: 8px 12px; border-radius: 5px; text-decoration: none; font-size: 0.9rem; margin-bottom: 1rem; display: inline-block; }
        .form-navigation { margin-top: 2rem; display: flex; justify-content: flex-end; gap: 1rem; clear: both; }
        .btn { padding: 0.8rem 1.5rem; border-radius: 5px; font-size: 1rem; font-weight: bold; cursor: pointer; text-align: center; text-decoration: none; border: 2px solid transparent; transition: all 0.3s; }
        .btn-primary { background-color: var(--primary-color); color: white; }
        .btn-primary:hover { background-color: #004a80; }
        .btn-secondary { background-color: #f0f0f0; color: var(--dark-gray); }
        .btn-secondary:hover { background-color: #e0e0e0; }
        #success-message { display: none; text-align: center; animation: fadeIn 0.5s; }
        #success-message h2 { color: var(--primary-color); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div class="form-container">
        <header class="header">
            <img src="logo.jpeg" alt="Logo ONG Monde et Bonheur" class="logo">
            <h2>MONDE ET BONHEUR ONG INTERNATIONALE</h2>
        </header>

        <h1>Votre Avenir Commence Ici</h1>
        
        <div class="progress-bar">
            <div class="progress-step active"></div>
            <div class="progress-step"></div>
            <div class="progress-step"></div>
            <div class="progress-step"></div>
        </div>

        <!-- Iframe caché pour recevoir la réponse du script sans rechargement -->
        <iframe name="hidden_iframe" id="hidden_iframe" style="display:none"></iframe>

<form id="inscriptionForm" action="https://script.google.com/macros/s/AKfycbzLxOCcf89vwNI68ncnVv1szbPPsuXoXpJrLaCLiBA-UEr5DPAVD8tRiVYq9LkzpnQ/exec" method="POST" target="hidden_iframe">
    <!-- Le reste du formulaire reste inchangé -->
        
            <fieldset class="form-step active">
                <legend>Votre Profil</legend>
                <p class="reassurance-message">"Le meilleur investissement que vous puissiez faire est en vous-même." - Warren Buffett</p>
                <div class="form-group"><label for="nom">Nom</label><input type="text" id="nom" name="nom" required></div>
                <div class="form-group"><label for="prenom">Prénom</label><input type="text" id="prenom" name="prenom" required></div>
                <div class="form-group"><label for="whatsapp">Contact WhatsApp</label><input type="tel" id="whatsapp" name="whatsapp" placeholder="+237 6XX XXX XXX" required></div>
                <div class="form-group"><label for="email">E-mail</label><input type="email" id="email" name="email" required></div>
                <div class="form-group">
                    <label for="pays">Pays de résidence</label>
                    <select id="pays" name="pays" required>
                        <option value="" disabled selected>-- Détection en cours... --</option>
                        <optgroup label="Afrique (Francophone)">
                            <option value="cm">Cameroun</option>
                            <option value="sn">Sénégal</option>
                            <option value="ci">Côte d'Ivoire</option>
                            <option value="bj">Bénin</option>
                            <option value="bf">Burkina Faso</option>
                            <option value="cg">Congo-Brazzaville</option>
                            <option value="cd">Congo-Kinshasa</option>
                            <option value="ga">Gabon</option>
                            <option value="gn">Guinée</option>
                            <option value="ml">Mali</option>
                            <option value="ne">Niger</option>
                            <option value="tg">Togo</option>
                        </optgroup>
                        <optgroup label="Europe">
                            <option value="fr">France</option>
                            <option value="be">Belgique</option>
                            <option value="ch">Suisse</option>
                            <option value="lu">Luxembourg</option>
                        </optgroup>
                        <optgroup label="Amérique du Nord">
                            <option value="ca">Canada</option>
                        </optgroup>
                        <optgroup label="Pays Anglophones">
                            <option value="gb">Royaume-Uni</option>
                            <option value="us">États-Unis</option>
                            <option value="ng">Nigéria</option>
                            <option value="gh">Ghana</option>
                        </optgroup>
                    </select>
                </div>
                <div class="form-navigation"><button type="button" class="btn btn-primary next-btn">Continuer</button></div>
            </fieldset>

            <fieldset class="form-step">
                <legend>Votre Projet</legend>
                <p class="reassurance-message">"Un objectif sans plan n'est qu'un souhait." - Antoine de Saint-Exupéry</p>
                <div class="form-group"><label for="category">Domaine de Formation</label><select id="category" name="category" required><option value="">-- Choisissez un domaine --</option></select></div>
                <div class="form-group"><label for="formation">Formation souhaitée</label><select id="formation" name="formation" required><option value="">-- Choisissez d'abord un domaine --</option></select></div>
                <div class="form-group"><label for="objectifs">Quels sont vos objectifs principaux ?</label><textarea id="objectifs" name="objectifs" placeholder="Ex: Développer de nouvelles compétences, changer de carrière, créer mon entreprise..."></textarea></div>
                <div class="form-navigation"><button type="button" class="btn btn-secondary prev-btn">Précédent</button><button type="button" class="btn btn-primary next-btn">Continuer</button></div>
            </fieldset>

            <fieldset class="form-step">
                <legend>Vos Préférences</legend>
                <p class="reassurance-message">"La flexibilité est la clé de la stabilité." - John Wooden</p>
                <div class="form-group"><label for="lieu">Modalité d'apprentissage</label><select id="lieu" name="lieu" required><option value="en_ligne">En ligne (100% à distance)</option><option value="presentiel">En présentiel (sur campus)</option><option value="hybride">Hybride (mix des deux)</option></select></div>
                <div class="form-group"><label for="session">Rythme souhaité</label><select id="session" name="session" required><option value="matin">Session du matin</option><option value="soir">Session du soir</option><option value="flexible">Rythme flexible</option></select></div>
                <div class="form-navigation"><button type="button" class="btn btn-secondary prev-btn">Précédent</button><button type="button" class="btn btn-primary next-btn">Continuer</button></div>
            </fieldset>
            
            <fieldset class="form-step">
                <legend>Finalisation</legend>
                <p class="reassurance-message">"Le voyage de mille lieues commence par un premier pas." - Lao Tseu</p>
                <div class="form-group"><label for="paiement">Méthode de paiement envisagée</label><select id="paiement" name="paiement" required></select></div>
                <div class="form-group" id="autrePaiementDiv" style="display: none;"><label for="paiementAutre">Veuillez préciser le moyen de paiement</label><input type="text" id="paiementAutre" name="paiementAutre"></div>
                <a href="https://wa.me/2348106814709" target="_blank" class="btn-whatsapp">Poser une question</a>
                <div class="form-navigation"><button type="button" class="btn btn-secondary prev-btn">Précédent</button><button type="submit" class="btn btn-primary" id="submitBtn">Envoyer ma candidature</button></div>
            </fieldset>
        </form>
        
        <div id="success-message">
            <h2>Merci, votre candidature a été envoyée !</h2>
            <p>Un membre de notre équipe d'admissions vous contactera très prochainement pour discuter des prochaines étapes.</p><br>
            <a href="https://wa.me/2348106814709?text=Bonjour, je viens de soumettre ma candidature et j'ai une question." class="btn btn-primary" target="_blank">Contacter sur WhatsApp</a>
        </div>
    </div>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Détection automatique du pays
        const paysSelect = document.getElementById('pays');
        fetch('https://ip-api.com/json/?fields=countryCode')
            .then(res => res.json())
            .then(data => {
                if (data.countryCode) {
                    const countryCode = data.countryCode.toLowerCase();
                    if (paysSelect.querySelector(`option[value="${countryCode}"]`)) {
                        paysSelect.value = countryCode;
                    }
                }
            })
            .catch(() => { console.log("Détection du pays échouée."); })
            .finally(() => {
                if (paysSelect.value === "") {
                    paysSelect.querySelector('option[disabled]').textContent = "-- Sélectionnez votre pays --";
                }
            });

        // Données des formations
        const trainingData = {
            "Action Humanitaire & Développement": ["Coordination de l'Action humanitaire", "Management des Projets/Programmes", "Suivi-Évaluation des Projets"],
            "Gestion & Entrepreneuriat": ["Création d'entreprise", "Gestion de startup", "Business plan"],
            "Informatique & Technologies": ["Développement web", "Cybersécurité", "Analyse de données"],
            "Santé & Services Sociaux": ["Santé publique", "Nutrition", "Psychologie"],
            "Communication & Médias": ["Journalisme", "Communication d'entreprise", "Relations publiques"]
        };
        
        const categorySelect = document.getElementById('category');
        const trainingSelect = document.getElementById('formation');
        
        Object.keys(trainingData).forEach(category => {
            const option = document.createElement('option');
            option.value = category;
            option.textContent = category;
            categorySelect.appendChild(option);
        });
        
        categorySelect.addEventListener('change', () => {
            trainingSelect.innerHTML = '<option value="">-- Choisissez une formation --</option>';
            const selectedCategory = categorySelect.value;
            if (selectedCategory && trainingData[selectedCategory]) {
                trainingData[selectedCategory].forEach(training => {
                    const option = document.createElement('option');
                    option.value = training;
                    option.textContent = training;
                    trainingSelect.appendChild(option);
                });
            }
        });

        // Gestion des étapes
        const prevBtns = document.querySelectorAll(".prev-btn");
        const nextBtns = document.querySelectorAll(".next-btn");
        const formSteps = document.querySelectorAll(".form-step");
        const progressSteps = document.querySelectorAll(".progress-step");
        let formStepsNum = 0;

        nextBtns.forEach(btn => {
            btn.addEventListener("click", () => {
                if (validateStep(formStepsNum)) {
                    formStepsNum++;
                    updateFormSteps();
                    updateProgressbar();
                }
            });
        });

        prevBtns.forEach(btn => {
            btn.addEventListener("click", () => {
                formStepsNum--;
                updateFormSteps();
                updateProgressbar();
            });
        });

        function updateFormSteps() {
            formSteps.forEach(step => step.classList.remove("active"));
            formSteps[formStepsNum].classList.add("active");
        }

        function updateProgressbar() {
            progressSteps.forEach((step, idx) => {
                step.classList.toggle("active", idx < formStepsNum + 1);
            });
        }

        function validateStep(stepIndex) {
            let isValid = true;
            const inputs = formSteps[stepIndex].querySelectorAll("input[required], select[required]");
            inputs.forEach(input => {
                input.classList.remove('invalid');
                if (!input.value.trim()) {
                    isValid = false;
                    input.classList.add('invalid');
                }
            });
            return isValid;
        }

        // Paiement
        const paiementSelect = document.getElementById('paiement');
        const autrePaiementDiv = document.getElementById('autrePaiementDiv');
        const autrePaiementInput = document.getElementById('paiementAutre');
        const modesDePaiement = ["Carte bancaire", "Orange Money", "Mobile Money (MTN, etc.)", "Ria", "Autre (à préciser)"];
        
        modesDePaiement.forEach(mode => {
            const option = document.createElement('option');
            option.value = mode;
            option.textContent = mode;
            paiementSelect.appendChild(option);
        });
        
        paiementSelect.addEventListener('change', () => {
            if (paiementSelect.value === "Autre (à préciser)") {
                autrePaiementDiv.style.display = 'block';
                autrePaiementInput.required = true;
            } else {
                autrePaiementDiv.style.display = 'none';
                autrePaiementInput.required = false;
            }
        });

        // ===== GESTION DE L'ENVOI DU FORMULAIRE =====
        const form = document.getElementById('inscriptionForm');
        const submitBtn = document.getElementById('submitBtn');
        const successMessage = document.getElementById('success-message');
        const progressBar = document.querySelector('.progress-bar');
        const header = document.querySelector('.header');
        const mainTitle = document.querySelector('h1');

        // Écouter les messages de l'iframe
        window.addEventListener('message', function(event) {
            console.log("Message reçu:", event.data); // Pour déboguer
            
            if (event.data === 'formSuccess') {
                // Succès : afficher le message de félicitations
                form.style.display = 'none';
                progressBar.style.display = 'none';
                mainTitle.style.display = 'none';
                header.style.display = 'none';
                successMessage.style.display = 'block';
            } else if (event.data === 'formError') {
                // Erreur : réactiver le bouton
                alert('Une erreur est survenue. Veuillez réessayer.');
                submitBtn.disabled = false;
                submitBtn.textContent = 'Envoyer ma candidature';
            }
        });

        // Gérer la soumission du formulaire
        form.addEventListener('submit', function(e) {
            // Désactiver le bouton immédiatement
            submitBtn.disabled = true;
            submitBtn.textContent = 'Envoi en cours...';
            
            // IMPORTANT: Ne pas faire e.preventDefault()
            // Le formulaire doit être soumis normalement vers l'iframe
            
            // Le reste est géré par l'attribut action et target du formulaire
            console.log("Formulaire soumis vers:", form.action);
        });

        // Sécurité : au cas où l'iframe ne répond pas, débloquer après 10 secondes
        setTimeout(function() {
            if (submitBtn.disabled) {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Envoyer ma candidature';
                console.log("Déblocage automatique après timeout");
            }
        }, 10000); // 10 secondes

        // Gestion des erreurs réseau (au cas où)
        const iframe = document.getElementById('hidden_iframe');
        iframe.addEventListener('error', function() {
            console.log("Erreur de chargement de l'iframe");
            submitBtn.disabled = false;
            submitBtn.textContent = 'Envoyer ma candidature';
            alert('Erreur de connexion. Vérifiez votre réseau.');
        });
    });
</script>
</body>
</html>

