<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Candidature en Ligne - Monde et Bonheur ONG</title>
    <style>
        :root { --primary-color: #005A9C; --light-gray: #f4f7f6; --dark-gray: #333; --border-color: #ccc; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: var(--light-gray); margin: 0; padding: 2rem; color: var(--dark-gray); display: flex; align-items: center; justify-content: center; min-height: 100vh; }
        .form-container { max-width: 800px; width: 100%; background-color: #ffffff; padding: 2.5rem 3rem 4rem 3rem; border-radius: 10px; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1); overflow: hidden; }
        .header { display: flex; align-items: center; justify-content: center; margin-bottom: 1rem; flex-wrap: wrap; }
        .logo { height: 50px; margin-right: 15px; }
        .header h2 { color: var(--dark-gray); font-size: 1.2rem; text-align: center; margin: 0; }
        h1 { color: var(--primary-color); text-align: center; margin-bottom: 2rem; font-size: 1.8rem; }
        .progress-bar { display: flex; justify-content: space-between; margin-bottom: 3rem; counter-reset: step; }
        .progress-step { width: 100%; text-align: center; position: relative; }
        .progress-step::before { counter-increment: step; content: counter(step); width: 30px; height: 30px; line-height: 30px; border: 2px solid var(--border-color); border-radius: 50%; display: block; margin: 0 auto 10px auto; background-color: white; color: var(--dark-gray); transition: all 0.3s ease; }
        .progress-step::after { content: ''; position: absolute; width: calc(100% - 40px); height: 2px; background-color: var(--border-color); top: 15px; left: -50%; z-index: -1; transition: all 0.3s ease; }
        .progress-step:first-child::after { content: none; }
        .progress-step.active::before { background-color: var(--primary-color); border-color: var(--primary-color); color: white; }
        .progress-step.active::after { background-color: var(--primary-color); }
        .form-step { display: none; animation: fadeIn 0.5s; }
        .form-step.active { display: block; }
        legend { font-size: 1.5rem; font-weight: 600; color: var(--primary-color); margin-bottom: 0.5rem; border: none; }
        .reassurance-message { font-size: 0.95rem; color: #7f8c8d; margin-bottom: 2rem; font-style: italic; }
        .form-group { margin-bottom: 1.5rem; }
        label { display: block; margin-bottom: 0.5rem; font-weight: 500; }
        input, select, textarea { width: 100%; padding: 0.8rem; border: 1px solid var(--border-color); border-radius: 5px; box-sizing: border-box; font-size: 1rem; }
        input.invalid, select.invalid, textarea.invalid { border-color: #e74c3c; }
        .btn-whatsapp { float: right; background-color: #25D366; color: white; padding: 8px 12px; border-radius: 5px; text-decoration: none; font-size: 0.9rem; margin-bottom: 1rem; display: inline-block; }
        .form-navigation { margin-top: 2rem; display: flex; justify-content: flex-end; gap: 1rem; clear: both; }
        .btn { padding: 0.8rem 1.5rem; border-radius: 5px; font-size: 1rem; font-weight: bold; cursor: pointer; text-align: center; text-decoration: none; border: 2px solid transparent; transition: all 0.3s; }
        .btn-primary { background-color: var(--primary-color); color: white; }
        .btn-primary:hover { background-color: #004a80; }
        .btn-secondary { background-color: #f0f0f0; color: var(--dark-gray); }
        .btn-secondary:hover { background-color: #e0e0e0; }
        #success-message { display: none; text-align: center; animation: fadeIn 0.5s; }
        #success-message h2 { color: var(--primary-color); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div class="form-container">
        <header class="header">
            <!-- CORRECTION : J'utilise "logo.jpeg" (minuscules) pour une meilleure compatibilité -->
            <img src="logo.jpeg" alt="Logo ONG Monde et Bonheur" class="logo">
            <h2>MONDE ET BONHEUR ONG INTERNATIONALE</h2>
        </header>

        <h1>Votre Avenir Commence Ici</h1>
        
        <div class="progress-bar">
            <!-- ... (pas de changement ici) ... -->
        </div>

        <form id="inscriptionForm">
            <!-- ... (pas de changement dans les fieldsets) ... -->
        </form>
        
        <div id="success-message">
             <!-- ... (pas de changement ici) ... -->
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // ... (pas de changement dans la première partie du script) ...

            const form = document.getElementById('inscriptionForm');
            const submitButton = document.getElementById('submitBtn');
            const successMessage = document.getElementById('success-message');
            
            // !!!!! ATTENTION : COLLEZ VOTRE URL LA PLUS RÉCENTE ICI !!!!!
            const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbwEwYmnsZM9XeLaVbhd0_MTg4rKIqKSgGFXXS8dm4_IemRNua-VE1F99dwz1-eD2po/exec';

            // --- GARDE-FOU DE SÉCURITÉ ---
            // On vérifie que l'URL n'est pas vide ou une valeur par défaut.
            if (!WEB_APP_URL || WEB_APP_URL === 'https://script.google.com/macros/s/AKfycbwEwYmnsZM9XeLaVbhd0_MTg4rKIqKSgGFXXS8dm4_IemRNua-VE1F99dwz1-eD2po/exec') {
                console.error("ERREUR CRITIQUE : L'URL de l'application Google n'est pas configurée dans le script !");
                alert("Erreur de configuration : Impossible de contacter le serveur. Veuillez contacter l'administrateur du site.");
                return; // On arrête tout le script d'envoi.
            }

            form.addEventListener('submit', function(e) {
                e.preventDefault();
                if (!validateStep(formStepsNum)) return;

                submitButton.disabled = true;
                submitButton.textContent = 'Envoi en cours...';

                const formData = new FormData(form);
                const data = Object.fromEntries(formData.entries());

                fetch(WEB_APP_URL, {
                    method: 'POST',
                    mode: 'cors',
                    cache: 'no-cache',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                })
                .then(res => {
                    // Une réponse réussie de la part de Google, même en cas d'erreur interne, ne devrait plus causer de "Failed to fetch".
                    if (!res.ok && res.status !== 200) { 
                         // Si on reçoit une erreur serveur (500, 403 etc.)
                         throw new Error(`Erreur réseau ou serveur : ${res.statusText} (${res.status})`);
                    }
                    return res.json();
                })
                .then(data => {
                    if (data.result === 'success') {
                        form.style.display = 'none';
                        document.querySelector('.progress-bar').style.display = 'none';
                        document.querySelector('h1').style.display = 'none';
                        document.querySelector('.header').style.display = 'none';
                        successMessage.style.display = 'block';
                    } else {
                        // Erreur interne renvoyée par notre script Google
                        throw new Error(data.error || 'Une erreur inconnue est survenue dans le script serveur.');
                    }
                })
                .catch(error => {
                    // Attrape les erreurs "Failed to fetch" (CORS) ET les erreurs réseau/serveur.
                    alert('Erreur lors de l\'envoi : ' + error.message);
                    console.error("Détails de l'erreur d'envoi :", error);
                    submitButton.disabled = false;
                    submitButton.textContent = 'Envoyer ma candidature';
                });
            });
        });
    </script>
</body>
</html>
